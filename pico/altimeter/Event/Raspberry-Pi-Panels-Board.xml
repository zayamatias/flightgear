<?xml version="1.0"?>

<PropertyList>
  <name type="string">Raspberry Pi Panels Board</name>
  <debug-events type="bool">true</debug-events>
  <nasal>
    <open>
            <![CDATA[
            
            setprop('/rpi/board/panel/roll',0);
            setprop('/rpi/board/panel/pitch',0);
            setprop('/rpi/board/panel/alt-1',0);
            setprop('/rpi/board/panel/alt-2',0);
            setprop('/rpi/board/panel/alt-3',0);
            setprop('/rpi/board/panel/alt-4',0);
            setprop('/rpi/board/panel/alt-5',0);
            setprop('/rpi/board/panel/corralt-1',0);
            setprop('/rpi/board/panel/corralt-2',0);
            setprop('/rpi/board/panel/corralt-3',0);
            setprop('/rpi/board/panel/corralt-4',0);
            setprop('/rpi/board/panel/corralt-5',0);
            setprop('/rpi/board/panel/corrected-altitude',0);

            var ascdict={};
            for (var i=32;i<127;i=i+1){
              var ch = sprintf('%c',i);
              print ('INSERTING [',ch,'] at [',i,']'); 
              ascdict[ch]=i;
            }

            var toAscii = func(myvalue,fullsize){
              if (myvalue==nil){
                return [0,0,0,0,0,0,0,0,0];
              }
              var retvect =[];
              if (myvalue<0){
                myvalue = myvalue*-1;
                append(retvect,45);
                fullsize=fullsize-1;
              }
              mystrvalue = sprintf("%i",myvalue);
              var mysize = size(mystrvalue);
              for (var i=0;i<(fullsize-mysize);i=i+1){
                append (retvect,48);
              }
              for (var i=0;i<mysize;i=i+1){
                var ch = substr(mystrvalue,i,1);
                var c = ascdict[ch];
                append (retvect,c);
              }
              return retvect;
            }


            var roll = func(){
              var myvalue = getprop('/instrumentation/attitude-indicator/indicated-roll-deg');
              print ('ROLL======================>',myvalue);
              setprop('/rpi/board/panel/roll',getprop('/instrumentation/attitude-indicator/indicated-roll-deg'));
            }

            var pitch = func(){
              var myvalue = getprop('/instrumentation/attitude-indicator/indicated-pitch-deg');
              print ('PITCH===================>',myvalue);
              setprop('/rpi/board/panel/pitch',getprop('/instrumentation/attitude-indicator/indicated-pitch-deg'));
            }

            var corralt = func(){
              var myvalue = getprop('/rpi/board/panel/corrected-altitude');
              if (myvalue==nil){
                myvalue = 0;
              }
              mystrvalue = sprintf("%05d",myvalue);
              print ('CORRECTED ALTITUDE======================>',mystrvalue);
              setprop('/rpi/board/panel/corralt-1',mystrvalue[0]);
              setprop('/rpi/board/panel/corralt-2',mystrvalue[1]);
              setprop('/rpi/board/panel/corralt-3',mystrvalue[2]);
              setprop('/rpi/board/panel/corralt-4',mystrvalue[3]);
              setprop('/rpi/board/panel/corralt-5',mystrvalue[4]);

            }
            var alt = func(){
              var myvalue = getprop('/instrumentation/altimeter/indicated-altitude-ft');
              if (myvalue==nil){
                myvalue = 0;
              }
              mystrvalue = sprintf("%05d",myvalue);
              print ('ALTITUDE======================>',mystrvalue);
              setprop('/rpi/board/panel/alt-1',mystrvalue[0]);
              setprop('/rpi/board/panel/alt-2',mystrvalue[1]);
              setprop('/rpi/board/panel/alt-3',mystrvalue[2]);
              setprop('/rpi/board/panel/alt-4',mystrvalue[3]);
              setprop('/rpi/board/panel/alt-5',mystrvalue[4]);
              
            }

            #var hdglis = setlistener('/instrumentation/attitude-indicator/indicated-roll-deg',roll,runtime=1);
            #var attlis = setlistener('/instrumentation/attitude-indicator/indicated-pitch-deg',pitch,runtime=1);
            var altlis = setlistener('/instrumentation/altimeter/indicated-altitude-ft',alt,runtime=0);
            var corraltlis = setlistener('/rpi/board/panel/corrected-altitude',corralt,runtime=0);

            ]]>
            </open>
            </nasal>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-1</name>
    <binding>
      <command>property-assign</command>
      <property>/rpi/board/panel/corrected-altitude</property>
      <value>0</value>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-thumb</name>
    <binding>
      <command>property-adjust</command>
      <property>/instrumentation/altimeter/setting-hpa</property>
      <step>1</step>
    </binding>
  </event>

  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-thumb2</name>
    <binding>
      <command>property-adjust</command>
      <property>/autopilot/settings/heading-bug-deg</property>
      <step>-1</step>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-top</name>
    <binding>
      <command>property-adjust</command>
      <property>/autopilot/settings/heading-bug-deg</property>
      <step>1</step>
    </binding>
  </event>

  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-top2</name>
    <binding>
      <command>property-adjust</command>
      <property>/instrumentation/nav/radials/selected-deg</property>
      <step>-1</step>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-pinkie</name>
    <binding>
      <command>property-adjust</command>
      <property>/instrumentation/nav/radials/selected-deg</property>
      <step>1</step>
    </binding>
  </event>

  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-base</name>
    <binding>
      <command>property-adjust</command>
      <property>/instrumentation/heading-indicator/offset-deg</property>
      <step>-1</step>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-base2</name>
    <binding>
      <command>property-adjust</command>
      <property>/instrumentation/heading-indicator/offset-deg</property>
      <step>1</step>
    </binding>
  </event>



  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-base3</name>
    <binding>
      <command>property-assign</command>
      <property>/testknob/value</property>
      <value>button-bas3</value>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-base4</name>
    <binding>
      <command>property-assign</command>
      <property>/testknob/value</property>
      <value>button-base4</value>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-base5</name>
    <binding>
      <command>property-assign</command>
      <property>/testknob/value</property>
      <value>button-base5</value>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-base6</name>
    <binding>
      <command>property-assign</command>
      <property>/testknob/value</property>
      <value>button-base6</value>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-300</name>
    <binding>
      <command>property-assign</command>
      <property>/testknob/value</property>
      <value>button-300</value>
    </binding>
  </event>
  <event>
    <desc>AUTOPILOT BTN</desc>
    <name>button-301</name>
    <binding>
      <command>property-assign</command>
      <property>/testknob/value</property>
      <value>button-301</value>
    </binding>
  </event>
  <event>
    <desc>ROLL</desc>
    <name>vendor-0</name>
    <setting>
      <property>/rpi/board/panel/alt-1</property>
    </setting>
  </event>
  <event>
    <desc>PITCH</desc>
    <name>vendor-1</name>
    <setting>
      <property>/rpi/board/panel/alt-2</property>
    </setting>
  </event>
  <event>
    <desc>ALTITUDE</desc>
    <name>vendor-2</name>
    <setting>
      <property>/rpi/board/panel/alt-3</property>
    </setting>
  </event>
  
  <event>
    <desc>ALT DIGIT 1</desc>
    <name>vendor-3</name>
    <setting>
      <property>/rpi/board/panel/alt-4</property>
    </setting>
  </event>
  <event>
    <desc>ALT DIGIT 2</desc>
    <name>vendor-4</name>
    <setting>
      <property>/rpi/board/panel/alt-5</property>
    </setting>
  </event>
  <event>
    <desc>ALT DIGIT 3</desc>
    <name>vendor-5</name>
    <setting>
      <property>/rpi/board/panel/corralt-1</property>
    </setting>
  </event>
  <event>
    <desc>ALT DIGIT 4</desc>
    <name>vendor-6</name>
    <setting>
      <property>/rpi/board/panel/corralt-2</property>
    </setting>
  </event>
  <event>
    <desc>ALT DIGIT 5</desc>
    <name>vendor-7</name>
    <setting>
      <property>/rpi/board/panel/corralt-3</property>
    </setting>
  </event>
  

  <event>
    <desc>VS DIGIT 1</desc>
    <name>vendor-8</name>
    <setting>
      <property>/rpi/board/panel/corralt-4</property>
    </setting>
  </event>
  <event>
    <desc>VS DIGIT 2</desc>
    <name>vendor-9</name>
    <setting>
      <property>/rpi/board/panel/corralt-5</property>
    </setting>
  </event>
  <event>
    <desc>VS DIGIT 3</desc>
    <name>vendor-10</name>
    <setting>
      <property>/rpi/board/panel/vs-3</property>
    </setting>
  </event>
  <event>
    <desc>VS DIGIT 4</desc>
    <name>vendor-11</name>
    <setting>
      <property>/rpi/board/panel/vs-4</property>
    </setting>
  </event>
  <event>
    <desc>VS DIGIT 5</desc>
    <name>vendor-12</name>
    <setting>
      <property>/rpi/board/panel/vs-5</property>
    </setting>
  </event>

  <event>
    <desc>HPA DIGIT 1</desc>
    <name>vendor-13</name>
    <setting>
      <property>/rpi/board/panel/hpa-1</property>
    </setting>
  </event>
  <event>
    <desc>HPA DIGIT 2</desc>
    <name>vendor-14</name>
    <setting>
      <property>/rpi/board/panel/hpa-2</property>
    </setting>
  </event>
  <event>
    <desc>HPA DIGIT 3</desc>
    <name>vendor-15</name>
    <setting>
      <property>/rpi/board/panel/hpa-3</property>
    </setting>
  </event>
  <event>
    <desc>HPA DIGIT 4</desc>
    <name>vendor-16</name>
    <setting>
      <property>/rpi/board/panel/hpa-4</property>
    </setting>
  </event>

  <event>
    <desc>AIRSP DIGIT 1</desc>
    <name>vendor-17</name>
    <setting>
      <property>/rpi/board/panel/airsp-1</property>
    </setting>
  </event>
  <event>
    <desc>AIRSP DIGIT 2</desc>
    <name>vendor-18</name>
    <setting>
      <property>/rpi/board/panel/airsp-2</property>
    </setting>
  </event>
  <event>
    <desc>AIRSP DIGIT 3</desc>
    <name>vendor-19</name>
    <setting>
      <property>/rpi/board/panel/airsp-3</property>
    </setting>
  </event>
  <event>
    <desc>AIRSP DIGIT 4</desc>
    <name>vendor-20</name>
    <setting>
      <property>/rpi/board/panel/airsp-4</property>
    </setting>
  </event>

  <event>
    <desc>HDB DIGIT 1</desc>
    <name>vendor-21</name>
    <setting>
      <property>/rpi/board/panel/hdb-1</property>
    </setting>
  </event>
  <event>
    <desc>HDB DIGIT 2</desc>
    <name>vendor-22</name>
    <setting>
      <property>/rpi/board/panel/hdb-2</property>
    </setting>
  </event>
  <event>
    <desc>HDB DIGIT 3</desc>
    <name>vendor-23</name>
    <setting>
      <property>/rpi/board/panel/hdb-3</property>
    </setting>
  </event>

</PropertyList>
